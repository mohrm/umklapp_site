{% extends "umklapp/base.html" %}
{% load bootstrap %}
{% block title %}Story anschauen{% endblock %}

{% block content %}
<div class="container">
<h2>
  {{ story.title }}
</h2>
{% if story.rules %}
<p>(ZusÃ¤tzliche Regeln: {{ story.rules }})</p>
{% endif %}

<div>
  &mdash; von {{ story.started_by }} und {{ story.numberOfContributors|add:-1 }} weiteren ErzÃ¤hlern.
  {% if has_upvoted %}
    <form style="display:inline" method="post" action="{% url 'downvote_story' story_id=story.id %}">
     {% csrf_token %}
     <button title="Downvote / UnLike" class="no-expand btn btn-default btn-xs btn-success">
      {{ upvote_count }}&nbsp;<span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
     </button>
     </form>
  {% else %}
    <form style="display:inline" method="post" action="{% url 'upvote_story' story_id=story.id %}">
     {% csrf_token %}
     <button title="Upvote / Like" class="no-expand btn btn-default btn-xs">
      {{ upvote_count }}&nbsp;<span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
     </button>
     </form>
  {% endif %}
</div>

{% for p in story.parts %}
  <form style="display:inline" method="post" action="{% spaceless %}
    {% if user in p.upvotes.all %}
      {% url 'downvote_storypart' storypart_id=p.id %}
    {% else %}
      {% url 'upvote_storypart' storypart_id=p.id %}
    {% endif %}
  {% endspaceless %}">
    <p class="sentence" >
      {{ p.content }}
      <small class="text-muted">â€“
        {% csrf_token %}
        <button title="Upvote / Like" class="no-expand btn btn-default btn-xs {% spaceless %}
          {% if user in p.upvotes.all %}btn-success{% endif %}
        {% endspaceless %}">
          {{ p.upvotes.count }}&nbsp;ðŸ˜‚
        </button>
        {% if not anonymized %}&nbsp;{{p.teller.user}}{% endif %}
      </small>
    </p>
  </form>
{% endfor %}

<div class="actions">
  {% if story.is_finished %}
  {% endif %}

  {% if story.started_by == user %}
    {% if not story.is_public %}
     <form style="display:inline" method="post" action="{% url 'publish_story' story_id=story.id %}">
      {% csrf_token %}
      <button title="Erlaube allen die Geschichte zu sehen" class="btn btn-default btn-sm">Geschichte Ã¶ffentlich sichtbar machen</button>
     </form>
    {% else %}
     <form style="display:inline" method="post" action="{% url 'unpublish_story' story_id=story.id %}">
      {% csrf_token %}
      <button title="Erlaube doch NICHT allen die Geschichte zu sehen" class="btn btn-default btn-sm">Geschichte nur den ErzÃ¤hlern sichtbar machen</button>
     </form>
    {% endif %}
  {% endif %}


</div>

</div>
{% endblock %}
